#!/usr/bin/python

import time
import random
import math

from dhtbot import constants
from dhtbot.node import xml_rpc_port
from dhtbot.xml_rpc.client import KRPC_Iterator_Client
import xmlrpclib


def rand_id():
    return random.getrandbits(constants.id_size)

def update_loop():
    r = k.find_node(ba, rand_id())
    nodes = r.nodes
    while True:
        try:
            new_nodes = k.find_iterate(rand_id(), nodes)
            nodes.update(new_nodes)
            ten_minutes = 10 * 60
            time.sleep(ten_minutes)
            print len(nodes)
        except xmlrpclib.Fault:
            print "caught a fault"


# Launch the client
k = KRPC_Iterator_Client("http://localhost:" + str(xml_rpc_port))

# Feel free to use whatever addresses you want
ba = bootstrap_address = ("67.18.187.143", 1337)

# The most popular infohash on thepiratebay.se as of 28-07-2012
ap = american_pie = long("871DB705B11CA07BD86203F3B772F52EF53905C4", 16)

# Launch an interactive shell
import code
code.interact(local=locals())
